{% extends "app/appbase.twig" %}

{% block title %}Petition{% endblock %}
{% block head %}
<style>
  .maintextarea img {
    max-width: 100%;
    max-height: 500px;
  }
</style>
{% endblock %}

{% block content %}
  <div class="petitionlayout">
    <section class="titlearea">
      <h1 class="mtop0">{{petition.title}}</h1>
      <div class="petitionprogress progress{{petition.status}}">
        <div class="progressStep"><i class="material-icons">edit_note</i></div>
        <div class="progressStep"><i class="material-icons">draw</i></div>
        <div class="progressStep"><i class="material-icons">verified</i></div>
        <div class="progressStep"><i class="material-icons">groups</i></div>
        <div class="progressText">{{petition.statusReadable}}</div>
      </div>
      <i class="material-icons primary">edit_note</i> {{petition.dateReadable}} - {{petition.author}}<br>
      <i class="material-icons accent">send</i> {{petition.recipient}}
      <q>{{petition.shortText | nl2br }}</q>
      {% for tag in petition.Tags %} <a href="/app/petitions?tags={{tag.id}}" class="tag">{{tag.name}}</a> {% endfor %}
    </section>
    <section class="maintextarea">
      <div class="usertext">
        {{petition.textHtml | raw}}
      </div>
    </section>
    <section class="dataarea">
      <div class="card mb">
        <h3>Unterstützung</h3>
        {% if supporterNames %}<small>u.a. {{supporterNames}}</small>{% endif %}
        <div class="supportersdisplay">
          <div class="current">{{petition.supporterCount}}</div>
          <div class="supportbar"><div class="indicator" style="width: {{indicatorLength}}%"></div><div class="percentage">{{indicatorLength}}%</div></div>
          <div class="goal">{{petition.goal}}</div>
        </div>
        {% if isSupporting %}
          <p>Du unterstützt diese Petition.</p>
        {% endif %}
        {% if isActive %}
        {% if isSupporting %}
          <form method="post">
            <button type="submit" name="support" value="0">nicht mehr unterstützen</button>
          </form>
        {% else %}
          <form method="post">
            <button type="submit" name="support" value="1">unterstützen</button>
          </form>
        {% endif %}
        {% endif %}
        <small>Du kannst in deinem <a href="/app/profile">Profil</a> ändern, ob und wie dein Name hier erscheinen darf.</small>
        <p><i class="material-icons">event</i>{{petition.deadlineReadable}}{% if isActive %} - {{daysLeft}} Tage verbleibend{% endif %}</p>
      </div>
      {% if user.id == petition.UserId or isAdmin %}
      <div class="card">
        {% if isAdmin %}<a href="/app/admin/user/{{petition.UserId}}"><i class="material-icons">person</i> von {{petition.User.email}}</a><br><br>{% endif %}
        {% if requireAdminConfirmationMsg %}
          <div class="card" style="width: 100%; max-width: 500px" id="error-msg">
            <i class="material-icons">warning</i> Nur Admins dürfen derzeit Petitionen von "inaktiv" auf "aktiv" schalten.
          </div>
        {% endif %}
        {% if nextStep %}
          <form method="post" onsubmit="return confirm('Den Status dieser Petition wirklich ändern?')" style="display: inline-block">
            <button type="submit" class="btn iconbtn" name="advance" value="1"><i class="material-icons">arrow_forward</i> als {{nextStep}} markieren</button>
          </form><br><br>
        {% endif %}
        {% if prevStep %}
          <form method="post" onsubmit="return confirm('Den Status dieser Petition wirklich ändern?')" style="display: inline-block">
            <button type="submit" class="btn iconbtn small secondary" name="back" value="1"><i class="material-icons">arrow_back</i> als {{prevStep}} markieren</button>
          </form><br><br>
        {% endif %}
        <a href="{{petition.id}}/edit" class="btn iconbtn important"><i class="material-icons">edit</i> bearbeiten</a>
        <form method="post" onsubmit="return confirm('Diese Petition wirklich löschen?')" style="display: inline-block">
          <button type="submit" class="btn iconbtn important" name="deletepetition" value="1"><i class="material-icons">delete</i> löschen</button>
        </form>
      </div>
      {% endif %}
    </section>
    <section class="commentsarea">
      <h1>Kommentare</h1>
      {% for comment in petition.PetitionComments %}
      <div class="card mb" id="comment{{comment.id}}">
        {% if isAdmin %}<a href="/app/admin/user/{{comment.User.id}}">{% endif %}{{comment.User.displayName}}{% if isAdmin %}</a>{% endif %} <small>({{comment.dateReadable}})</small>
        <hr>
        {% if comment.User.id == user.id or isAdmin %}
        <form method="post" class="inline" style="float: right"><button type="submit" class="small iconbtn important" name="deletecomment" value="{{comment.id}}"><i class="material-icons">delete</i></button></form>
        {% endif %}
        <div class="usertext">{{comment.text}}</div>
      </div>
      {% endfor %}
      <div class="card mb">
      <h4>Du hast Gedanken dazu?</h4>
        <small>Du kannst in deinem <a href="/app/profile">Profil</a> ändern, ob und wie dein Name hier erscheinen darf.</small>
        <form method="post">
          <div class="inputlabel">
            <label>Bitte sei freundlich zu anderen Studierenden und dem Adressaten!</label>
            <textarea name="comment" class="short usertext" placeholder="Dein Kommentar..."></textarea>
          </div><br>
          <button type="submit">Kommentar abschicken</button>
        </form>
      </div>
    </section>
  </div>
{% endblock %}