{% extends "base.twig" %}

{% block title %}Login{% endblock %}

{% block content %}
  <section id="splash">
    FSmed Berichte
    <p>Gedankenprotokolle von mündlichen Examen und Prüfungen, sowie Berichte über Arbeitsgruppen.</p>
  </section>
  <div style="padding: 16px;">
  {% if hasError %}<section class="login-area card" id="error-msg"><i class="material-icons">warning</i> {{ errorMsg }}</section>{% endif %}
    <section class="login-area card">
      <h3>Login</h3>
      <form action="/login{{loginGoto}}" method="POST">
        <input type="email" name="email" placeholder="E-Mail">
        <div class="pwinput" id="pw-login">
          <input type="password" name="password" placeholder="Passwort">
          <i class="material-icons on">visibility</i>
          <i class="material-icons off">visibility_off</i>
        </div>
        <input type="submit" value="einloggen" class="btn important">
      </form>
    </section>
    <section class="login-area card">
      <h3>Registrierung</h3>
      Nutze zur Registrierung deine <strong>@stud.uni-heidelberg.de</strong> Adresse.
      Falls du keine besitzt, gib einen Grund an, weshalb du Zugriff benötigst, um dich freischalten zu lassen.
      <form action="/register{{loginGoto}}" method="POST">
        <input type="email" name="email" id="regemail-inp" placeholder="E-Mail">
        <div class="pwinput" id="pw-reg">
          <input type="password" name="password" placeholder="Passwort">
          <i class="material-icons on">visibility</i>
          <i class="material-icons off">visibility_off</i>
        </div>
        <div class="pwinput" id="pw-reg-repeat">
          <input type="password" name="repeatPassword" placeholder="Passwort wiederholen">
          <i class="material-icons on">visibility</i>
          <i class="material-icons off">visibility_off</i>
        </div>
        <small class="nohd" style="display: block;">Weshalb benötigst du Zugriff (nur bei Registrierung ohne stud.uni-heidelberg.de Adresse notwendig)</small>
        <textarea class="nohd" name="reason" style="height: 5rem; display: block;" placeholder="Begründung zur Freischaltung, wenn du von einer anderen Uni kommst"></textarea>
        <br>
        <input type="submit" value="registrieren">
      </form>
    </section>
    <section class="login-area card">
      <h3>Passwort vergessen</h3>
      <form action="/forgotpwd" method="POST">
        <input type="email" name="email" placeholder="E-Mail">
        <input type="submit" value="Passwort zurücksetzen">
      </form>
    </section>
    <section class="login-area" style="text-align: center">
      &copy; Leander Berg, 2023. Licensed under <a href="/assets/LICENSE.txt" target="_blank">MIT License</a>.<br>
      Code at <a href="https://github.com/lulebe/fs-berichte">GitHub</a><br>
      <a href="https://www.fsmed-hd.de/impressum/">Impressum</a>
    </section>
  </div>
{% endblock %}

{% block js %}
<script type="text/javascript">
  function makePWVisibilityToggle (container) {
    const elContainer = document.getElementById(container)
    const elOn = elContainer.querySelector('i.on')
    const elOff = elContainer.querySelector('i.off')
    const elInput = elContainer.querySelector('input')
    elOff.style.display = 'none'
    elOn.addEventListener('click', e => {
      elOn.style.display = 'none'
      elOff.style.display = 'block'
      elInput.type = 'text'
    })
    elOff.addEventListener('click', e => {
      elOff.style.display = 'none'
      elOn.style.display = 'block'
      elInput.type = 'password'
    })
  }
  makePWVisibilityToggle('pw-login')
  makePWVisibilityToggle('pw-reg')
  makePWVisibilityToggle('pw-reg-repeat')

  const nohdElements = document.querySelectorAll('.nohd')
  document.getElementById('regemail-inp').addEventListener('input', e => {
    if (e.target.value.endsWith('@stud.uni-heidelberg.de') || !e.target.value.includes('@')) {
      for (let i = 0; i < nohdElements.length; i++) {
        nohdElements[i].style.display = 'none'
      }
    } else {
      for (let i = 0; i < nohdElements.length; i++) {
        nohdElements[i].style.display = 'block'
      }
    }
  })
</script>
{% endblock %}
